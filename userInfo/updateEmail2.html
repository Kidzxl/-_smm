<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link rel="stylesheet" href="static/css/amazeui.min.css" />
		<script type="text/javascript" src="static/js/jquery-1.9.1.min.js"></script>
		<script type="text/javascript" src="static/js/amazeui.min.js"></script>
		<link rel="stylesheet" href="static/css/zpwd/sjsz.css" />
		<link rel="stylesheet" href="static/css/sui.css" />
		<script type="text/javascript" src="static/js/sui.js"></script>
		<link rel="stylesheet" href="static/css/jd.css" />
		<title></title>
		<style>
			/*.bottomLine {
				border-bottom: 1px solid #ccc;
				border-top: 1px solid #ccc;
				margin-bottom: 10px;
				/*padding: 10px;*/
			/*padding-top: 10px;
				padding-bottom: 10px;
				word-spacing: 0.05rem;
				text-align: center;
				margin-top: 82px;*/
			/*width:677px ;*/
			/*line-height: ;*/
			/*}*/
			
			.bottomLine {
				border-bottom: 1px solid #ccc;
				border-top: 1px solid #ccc;
				padding-top: 8px;
				/*padding-bottom:10px;*/
			}
			
			.bot {
				margin-bottom: 50px;
				/*text-align: center;*/
				color: #7b6f5b;
			}
			
			.radio-pretty.checked > span:before {
				color: #f88600;
			}
			
			input {
				height: 62px;
			}
			
			.imgbot {
				width: 128px;
				height: 128px;
			}
			.am-form-field {
    display: inline;
    width: 100%;
    width: 90%;
    padding: .5em;
    font-size: 1.6rem;
    line-height: 1.2;
    color: #555;
    vertical-align: middle;
    background-color: #fff;
    background-image: none;
    border: 1px solid #ccc;
    border-radius: 0;
    -webkit-appearance: none;
    -webkit-transition: border-color .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;
    transition: border-color .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;
    transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out;
    transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;
}
		</style>
	</head>

	<body>
		<!--<div class="am-g" style="margin-top: 25px;">
			
		</div>-->
		<div style="background-color: #F8F8F8;padding-top: 40px;">
		<div class="am-g" id="user-info">
			<div class="logo"> <img src="../static/img/logo.png" style="    float: left" />
				<p style="font-size: 16px;color: #3d3d3d;margin-left: 16px;font-weight: bold;margin-top: 20px;    float: left">修改邮箱</p>
			</div>
			<div style="width: 1200px;margin: 0 auto;font-size: 12px;margin-top: -38px;"> <span style="float: right;color: #333333;">您好,{{user.username}}<span style="margin-left: 20px;margin-right: 20px;">|</span>退出<span style="margin-left: 20px;margin-right: 20px;">|</span>我的买啦</span>
			</div>
		</div>
		</div>
		<div style="background-color: #ffffff;padding-top: 30px;margin-top: 21px;">
			<div class="am-g content" style="margin-top: 45px;">
				<div data-am-widget="tabs" class="am-tabs am-tabs-d2">
					<ul class="am-tabs-nav1" style="margin-top: 20px;display:flex;list-style: none;text-align: center;">
						<li style="max-width: 95px; margin-left: 100px;"></li>
						<li style="max-width: 80px;"><span class="am-badge1 am-round am-badge-warning-active " style="background-color: #F89406;font-size: 18px;">1</span>
							<br />
							<p class="bottitle active">验证身份</p>
						</li>
						<li style="max-width: 273px;">
							<hr style="width: 273px;    border-top: 3px #F89406 solid;">
						</li>
						<li style="max-width: 80px;margin-left: 10px;"><span class="am-badge1  am-round am-badge-warning-active" style="background-color: #F89406;font-size: 18px">2</span>
							<br />
							<p class="bottitle active">修改邮箱</p>
						</li>
						<li style="max-width: 273px;">
							<hr style="height: 3px;">
						</li>
						<li style="max-width: 80px;margin-left: 10px;"><span class="am-badge1  am-round" style="background-image: url(static/img/duihao.png);background-repeat: no-repeat;background-position: center;background-position-x: 5px;"></span>
							<br />
							<p style="margin-left: -10px">完成</p>
						</li>
					</ul>
					<!--输入账户名-->
					<div class="am-tabs-bd" style="margin-left: 300px;" id="update">
						<div data-tab-panel-0 class="am-tab-panel am-active" style="margin-top: 20px;font-size: 14px;">
							<div class="am-g" style="margin-top: 20px;margin-left: 55px;">
								<span >输入新的邮箱:</span>
								<input v-model="newEmail" class="am-form-field" type="email" style="width: 285px;height: 45px;margin-left: 22px;" />
							</div>
							<div class="am-g" style="margin-top: 20px;margin-left:125px;">
								<button id="bnt" @click="checkEmailAndGetCode" style="width: 114px;height: 47px;margin-left: 70px; background-color:dodgerblue;color: #fff;border: 0px;border-radius: 5px;" >获取验证码</button>
							</div>
							
							<div class="am-g" style="margin-top: 20px;margin-left: 100px;">
								<span >验证码:</span>
								<input v-model="code" class="am-form-field" type="text" style="width: 285px;height: 45px;margin-left: 15px;padding-left: 10px;" placeholder="请入验证码" />
							</div>
							<div class="am-g" style="margin-top: 30px;margin-left: 165px;">
								<button type="button" @click="submit" class="am-btn am-btn-warning" style="width: 265px;height: 50px;font-size: 16px;border: 1px rgba(187, 187, 187, 0.5) solid;margin: 0 auto;border-radius: 5px;">
									<span class="btn" >确定</span>
								</button>
							</div>
							<div class="am-g" style="padding-top:40px;padding-left:50px;border: 1px rgba(241,161,69, 0.18) solid;   margin-left:0px;margin-top:50px;height: 169px;width: 718px;background-color: #FEFBEE;">
							
							<span style="font-size: 14px;font-weight: bold;">没收验证码</span>	
							<p style="font-size: 12px;margin-top: 10px;">1.网络通信异常可能会造成短信丢失,请重新获取或稍后重试</p>
							<p style="font-size: 12px;margin-top: -6px;">2.请核实邮箱是否正常使用,并检查垃圾邮件</p>
							</div>
							
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="am-g " style="margin-top: 81px;text-align: center;font-size: 12px;">
			<div class="bottomLine" style="margin:0 auto;width:700px;height: 35px;">
				<span style="float: left;word-spacing:0.52rem;    text-align: center;    width: 100%;">关于我们 | 联系我们 | 商家入驻 | 友情链接 | 站点地图 | 手机商城 | 销售联盟 | 商城社区 | 企业文化 | 帮助中心 
			</span>
			</div>
		</div>
		<div class="am-g">
			<div class="bot ">
				<div style="margin:0 auto;width:700px;height: 30px;">
					<p style="font-size: 12px;float: left;">© &nbsp;2005-2016 买啦网 版权所有 ，并保留所有权利 <span style="margin-left: 30px;">买啦 Tel ：4008125181 </span><span style="margin-left: 30px;">E-mai：maila@163.com</span> </p>
				</div>
			</div>
		</div>
		</div>

		<!--Vue-->
		<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
		<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
		<script src="../static/login/js/jquery.cookie.js" ></script>
		<script>
            var  u =null ;
            if ($.cookie("user")!=null){
                u = JSON.parse($.cookie("user"));
            }
            console.log(u);
            var userInfo = new Vue({
                el:"#user-info",
                data:{
                    user:u,
                },
                methods:{
                    test:function () {
                        console.log(this.user)
                    }
                }
            });
            var updateEmail = new Vue({
                el:"#update",
                data:{
                    user:u,
                    newEmail:"",
                    code:"",
                },
                methods:{
                    checkEmailAndGetCode:function () {
                        alert(this.oldEmail);
                        var time = 3;
                        $("#bnt").attr("disabled","disabled");
                        $("#bnt").css("background-color","rgb(178,158,158)");
                        var that = this;
                        $.ajax({
                            type: "GET",
                            url: "http://192.168.0.106:80/ssm/user/getCode",  //未完成
                            data:{email:that.newEmail},
                            success: function(response){
                                console.log(response);
                                if (response.code == 200){
                                    var code = response.data.value;
                                    var date = new Date();
                                    date.setTime(date.getTime() + (60 * 1000));
                                    $.cookie('code', code, { expires: date });
                                }else{
                                    console.log("获取验证码出错")
                                }
                            },
                            error:function (XMLHttpRequest, textStatus, errorThrown) {
                                console.log("服务器失败")
                            }
                        });
                        var time = 30;
                        var interval= setInterval(()=>{
                            if(time <=0 ){
                                $("#bnt").attr("disabled",false);
                                $("#bnt").css("background-color","dodgerblue");
                                $("#bnt").html("获取验证码");
                                time = 30;
                                clearInterval(interval);
                            }else{
                                $("#bnt").attr("disabled",true);
                                $("#bnt").html("重新获取("+time+")");
                                time--;
                            }
                        },1000);
                    },
                    submit:function () {
                        var userCode = this.code;
                        var code = $.cookie("code");
                        if(!code){
                            alert("请先获取验证码");
                            return ;
                        }
                        if(userCode.length==0 || userCode==""|| !userCode){
                            alert("请输入验证码");
                            return ;
                        }
                       if(userCode != code){
                            alert("验证码错误，请重新输入");
                            this.code = "";
                        }else{
                            var date = new Date();
                            date.setTime(date.getTime() + (0 * 1000));
                            $.cookie("code",null,{ expires: date });
                            var that = this;
                            that.user.email = this.newEmail;
                            console.log(that.user);
                            $.ajax({
                                type: "POST",
                                url: "http://192.168.0.106:80/ssm/user/updateEmail",
                                data:that.user,
//								dataType:json,
                                success: function(response){
                                    console.log(response);
                                    if (response.code == 200){
                                        $.cookie("user",response.data.value);
                                        u = $.cookie("user");
                                        user = u;
                                    }else{
                                        console.log("获取验证码出错")
                                    }
                                },
                                error:function (XMLHttpRequest, textStatus, errorThrown) {
                                    console.log("服务器失败")
                                }
                            });
                            window.location.href= "updateEmail3.html";
                        }
                    }
                }
            })
		</script>
	</body>

</html>